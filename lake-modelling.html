<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Vassdragskalking applikasjon - Lake modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Vassdragskalking applikasjon</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lake-modelling.html">
 <span class="menu-text">Lake modelling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./column-tests.html">
 <span class="menu-text">Column tests</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Lake modelling</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        <div class="sidebar-tools-collapse">
    <a href="" title="" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-github"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-collapse-item" href="https://github.com/NIVANorge/lake_liming_app">
          GitHub repository
          </a>
        </li>
    </ul>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lake-modelling.html" class="sidebar-item-text sidebar-link active">Lake modelling</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./column-tests.html" class="sidebar-item-text sidebar-link">Column tests</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-lime-types" id="toc-sec-lime-types" class="nav-link active" data-scroll-target="#sec-lime-types"><span class="toc-section-number">1</span>  Types of lime</a></li>
  <li><a href="#sec-solubility" id="toc-sec-solubility" class="nav-link" data-scroll-target="#sec-solubility"><span class="toc-section-number">2</span>  Lime solubility</a></li>
  <li><a href="#sec-ca-ph" id="toc-sec-ca-ph" class="nav-link" data-scroll-target="#sec-ca-ph"><span class="toc-section-number">3</span>  Relationships between Ca and pH</a></li>
  <li><a href="#sec-mass-bal-model" id="toc-sec-mass-bal-model" class="nav-link" data-scroll-target="#sec-mass-bal-model"><span class="toc-section-number">4</span>  Mass balance model</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Lake modelling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The calculations performed by the application and described on this page are a subset of those implemented by the original <a href="https://niva.brage.unit.no/niva-xmlui/handle/11250/208709">TPKALK application</a> developed by NIVA during the 1990s.</p>
<section id="sec-lime-types" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-lime-types"><span class="header-section-number">1</span> Types of lime</h2>
<p>Lime products used for catchment management are usually a mixture of <strong>calcium carbonate</strong> (calcite, <span class="math inline">\(CaCO_3\)</span>) and <strong>magnesium carbonate</strong> (<span class="math inline">\(MgCO_3\)</span>). Rocks composed primarily of <span class="math inline">\(CaCO_3\)</span> are commonly called <strong>limestones</strong>, whereas carbonate rocks with significant proportions of magnesium are called <strong>dolomites</strong> or dolomitic limestones.</p>
<p>Lime manufacturers will typically specify the proportion of calcium and magnesium carbonate in their products. For example, <code>Microdol5</code> is reported as being 53.7% <span class="math inline">\(CaCO_3\)</span> and 44.4% <span class="math inline">\(MgCO_3\)</span> by mass (with 1.9% other impurities).</p>
<p>Magnesium carbonate has a higher acid neutralising capacity (ANC) than calcium carbonate: 1 g of magnesium carbonate will neutralise as much acid as 1.19 g of calcium carbonate. When comparing limes with different compositions, it is therefore common to multiply the magnesium carbonate proportion by a factor of 1.19. This gives a <strong>total neutralising value (TNV)</strong>, estimated as the sum of calcium carbonate <em>equivalents</em> (e.g. <a href="#tbl-nv">Table&nbsp;1</a>).</p>
<div id="tbl-nv" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Estimating the <strong>total neutralising value (TNV)</strong> for two lime products. <span class="math inline">\(MgCO_3\)</span> content is converted to <span class="math inline">\(CaCO_3\)</span>-equivalents by multiplying by 1.19.</caption>
<colgroup>
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th colspan="2"><strong>Parameter</strong></th>
<th><strong>Microdol5</strong></th>
<th><strong>VK3</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Calcium</strong></td>
<td><ul>
<li>CaCO3 (%)</li>
</ul></td>
<td><pre><code>   53.7</code></pre></td>
<td>99.0</td>
</tr>
<tr class="even">
<td><strong>Magnesium</strong></td>
<td><ul>
<li>MgCO3 (%)</li>
<li>CaCO3-ekv (%)</li>
</ul></td>
<td><pre><code>   44.4
   52.8</code></pre></td>
<td><pre><code>1.0
1.2</code></pre></td>
</tr>
<tr class="odd">
<td colspan="2"><strong>TNV</strong> (sum of CaCO3-ekv; %)</td>
<td><pre><code>  106.5</code></pre></td>
<td>100.2</td>
</tr>
</tbody>
</table>
</div>
<p>TNV is usually specified in percent: pure calcium carbonate has a TNV of 100 %, pure magnesium carbonate has a TNV of 119 %, and typical dolomite products have TNVs that are somewhere in between. Weight for weight, products with a higher TNV will be more effective at increasing pH, <em>as long as all the lime dissolves</em>. In practice, different limes exhibit different dissolution rates, which must also be accounted for.</p>
</section>
<section id="sec-solubility" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-solubility"><span class="header-section-number">2</span> Lime solubility</h2>
<p>Several factors affect the dissolution rate of lime material added to a waterbody. These include:</p>
<ul>
<li><p><strong>Physical</strong> and <strong>chemical</strong> properties of the lime (crystal structure etc.).</p></li>
<li><p><strong>Particle size</strong> (i.e.&nbsp;fineness) of the lime material - smaller particles give a larger reaction surface and therefore dissolve faster.</p></li>
<li><p><strong>Water pH</strong> - more acidic lakes react with the lime more vigorously.</p></li>
<li><p><strong>Application method</strong> (for example from a boat versus from a helicopter).</p></li>
<li><p>Amount of lime added, usually called the <strong>dose</strong>. If large amounts of lime are added to a lake all at once, the overall effect on pH is less than might be achieved if smaller amounts were added more regularly. This is because, at high doses, pH and calcium concentration increase in the immediate vicinity of the lime particles, which then sink to the bottom without dissolving efficiently. It is also more likely that lime particles will clump together and sink more rapidly. This effect is called <strong>overdosing</strong>.</p></li>
</ul>
<p>Most commercial lime products are fine enough to dissolve effectively. For a given application method and lake pH, the goal is therefore to identify <strong>which lime product to use</strong> (i.e.&nbsp;which physical and chemical properties to select) and <strong>in what dose</strong> (to minimise the number of applications necessary, without excessive waste due to overdosing).</p>
<p>Lime dissolution rates and the effects of overdosing are determined experimentally - see the <a href="./column-tests.html">Column tests</a> page for details.</p>
</section>
<section id="sec-ca-ph" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-ca-ph"><span class="header-section-number">3</span> Relationships between Ca and pH</h2>
<p>A simple empirical relationship between pH and change in calcium concentration is given in <a href="#eq-ph-ca">Equation&nbsp;1</a></p>
<p><span id="eq-ph-ca"><span class="math display">\[
pH = pH_0 + A_{pH} log(\Delta Ca)
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(pH\)</span> is the expected pH <em>after</em> liming; <span class="math inline">\(pH_0\)</span> and <span class="math inline">\(A_{pH}\)</span> are constants determined by lake properties; and <span class="math inline">\(\Delta Ca\)</span> is the change in calcium concentration due to liming expressed in <span class="math inline">\(\mu ekv/l\)</span> (i.e.&nbsp;micro-moles of charge).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We need to check this equation, as its physical interpretation seems questionable: it only makes sense for <span class="math inline">\(\Delta Ca \geq 1\)</span>; adding smaller amounts of Ca than this actually <em>reduces</em> the pH. Furthermore, if <span class="math inline">\(\Delta Ca\)</span> is zero, the result is undefined, whereas I would expect the change in pH for this case to be zero and for <span class="math inline">\(pH_0\)</span> to reflect the pH before liming. Wouldn’t it make more sense to either regress expected change in pH against change in Ca, or simply pH against Ca?</p>
</div>
</div>
<p>For any given lake, if detailed measurements of pH and calcium concentration are available before and after liming, the parameters <span class="math inline">\(pH_0\)</span> and <span class="math inline">\(A_{pH}\)</span> can be estimated from <a href="#eq-ph-ca">Equation&nbsp;1</a> using linear regression. If measured data are not available, the <a href="https://niva.brage.unit.no/niva-xmlui/bitstream/handle/11250/208709/3412_200dpi.pdf?sequence=2&amp;isAllowed=y">TPKALK report</a> suggests default values based on water colour and pH <em>before</em> liming (<a href="#tbl-ph0-aph">Table&nbsp;2</a>). TPKALK also constrains user-supplied values of <span class="math inline">\(pH_0\)</span> to lie in the range 0 to 6, and <span class="math inline">\(A_{pH}\)</span> to be in the range from 0 to 3.</p>
<div id="tbl-ph0-aph" class="anchored">
<table class="table">
<caption>Table&nbsp;2: Suggested values for the parameters <span class="math inline">\(pH_0\)</span> and <span class="math inline">\(A_{pH}\)</span> for lakes with different initial water chemistry (pH and colour). From Table 2 of the <a href="https://niva.brage.unit.no/niva-xmlui/bitstream/handle/11250/208709/3412_200dpi.pdf?sequence=2&amp;isAllowed=y">TPKALK report</a>.</caption>
<thead>
<tr class="header">
<th>pH før kalking</th>
<th>Fargetall (mgPt)</th>
<th><span class="math inline">\(pH_0\)</span></th>
<th><span class="math inline">\(A_{pH}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>0</td>
<td>3.5</td>
<td>1.8</td>
</tr>
<tr class="even">
<td>5</td>
<td>&lt; 5</td>
<td>3.9</td>
<td>1.2</td>
</tr>
<tr class="odd">
<td>&lt; 5</td>
<td>&lt; 20</td>
<td>3.5</td>
<td>1.5</td>
</tr>
<tr class="even">
<td>5</td>
<td>&gt; 20</td>
<td>4.3</td>
<td>0.7</td>
</tr>
</tbody>
</table>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Simple worked example
</div>
</div>
<div class="callout-body-container callout-body">
<p>The expected change in lake pH <strong>soon after liming</strong> can be estimated using <a href="#eq-ph-ca">Equation&nbsp;1</a> and data describing how much of the lime will dissolve quickly (i.e.&nbsp;the <strong>instantaneous dissolution</strong> from <a href="./column-tests.html">column tests</a>).</p>
<p>Consider a lake with an initial pH of 4.5, colour value of 15 mgPt and a volume of 1 000 000 <span class="math inline">\(m^3\)</span>. 50 tonnes of <code>Miljøkalk EY3</code> added, which corresponds to a <strong>dose</strong> 50 <span class="math inline">\(g/m^3\)</span> or 50 mg/l of lime. Based on the figure <a href="https://nivanorge.github.io/lake_liming_app/column-tests.html#fig-overdosing-curve">here</a>, the overdosing factor for this lime at 50 mg/l is 2.2, which means around <span class="math inline">\(100 / 2.2 = 45.5 \ %\)</span> of the lime will dissolve rapidly. Furthermore, the calcium content of this lime reported by the manufacturer is 38.5 %. We therefore expect the liming operation to change the concentration of calcium in the lake by <span class="math inline">\(0.45 \times 0.385 \times 50 = 8.75\)</span> mg/l, which corresponds to <span class="math inline">\(\Delta Ca = 437.5 \ \mu ekv/l\)</span>.</p>
<p>Using <a href="#tbl-ph0-aph">Table&nbsp;2</a>, for this lake <span class="math inline">\(pH_0 = 3.5\)</span> and <span class="math inline">\(A_{pH} = 1.5\)</span>. Substituting values into <a href="#eq-ph-ca">Equation&nbsp;1</a> yields an estimate for the pH shortly after liming of around 7.5.</p>
</div>
</div>
</section>
<section id="sec-mass-bal-model" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sec-mass-bal-model"><span class="header-section-number">4</span> Mass balance model</h2>
<p>The example above is simplistic, since it ignores several factors that influence long term calcium concentrations in lake water. In particular, the example only considers short term effects from instantaneous dissolution and ignores longer terms effects of lime accumulating on the lake bottom and dissolving over periods of months and years.</p>
<p>To provide an estimate of both the initial change in lake conditions due to liming and the subsequent evolution over time, the original TPKALK model implemented a mass balance “box model”(<a href="#fig-box-model">Figure&nbsp;1</a>) where:</p>
<ul>
<li><span class="math inline">\(D\)</span> is the dose of lime added (adjusted for Ca content i.e.&nbsp;the actual dose of Ca in mg/l)</li>
<li><span class="math inline">\(C_{inst}\)</span> is the “immediate” increase in lake Ca concentration (in mg/l) due to <strong>instantaneous dissolution</strong></li>
<li><span class="math inline">\(C_{bott} = D - C_{inst}\)</span> is the amount of Ca (in mg/l) that sinks to the lake bottom, forming a layer that dissolves more slowly</li>
<li><span class="math inline">\(F_{slow}\)</span> is the rate at which concentration increases (in mg/l/month) due to dissolution of the bottom layer</li>
<li><span class="math inline">\(C_{in}\)</span> and <span class="math inline">\(C_{out}\)</span> are the inflow and outflow concentrations of Ca, respectively (both in mg/l)</li>
<li><span class="math inline">\(V\)</span> is the lake volume in litres. The lake is assumed to be in <strong>steady state</strong> i.e.&nbsp;<span class="math inline">\(V\)</span> is constant</li>
<li><span class="math inline">\(Q\)</span> is the discharge in l/month. To satisfy the steady state assumption, the inflow discharge must equal the outflow discharge</li>
<li><span class="math inline">\(M_{lake}\)</span> is the mass of Ca dissolved in the lake water (in mg)</li>
<li><span class="math inline">\(C_{lake}\)</span> is the Ca concentration in the lake, equal to <span class="math inline">\(\frac{M_{lake}}{V}\)</span>. The lake is assumed to be <strong>well mixed</strong>, such that the outflow concentration, <span class="math inline">\(C_{out}\)</span>, is equal to <span class="math inline">\(C_{lake}\)</span></li>
</ul>
<div id="fig-box-model" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./images/box_model.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: TPKALK box model for lake calcium concentration in a single lake under the assumption of fixed water volume. Symbols are defined in the text.</figcaption><p></p>
</figure>
</div>
<p>Balancing the main sources and sinks of Ca to the lake gives</p>
<p><span id="eq-dMlake_dt"><span class="math display">\[
\frac{dM_{lake}}{dt} = V \frac{dC_{lake}}{dt} = Q C_{in} - Q C_{lake} + V C_{inst} + V F_{slow}
\tag{2}\]</span></span></p>
<p>or</p>
<p><span id="eq-dClake_dt"><span class="math display">\[
\frac{dC_{lake}}{dt} = \frac{Q C_{in} - Q C_{lake}}{V} + C_{inst} + F_{slow}
\tag{3}\]</span></span></p>
<p>The lime that sinks to the bottom, <span class="math inline">\(C_{bott}\)</span>, is assumed to dissolve quickly at first, then more slowly as time passes. TPKALK uses an exponential function to represent this slow dissolution effect</p>
<p><span id="eq-dCslow_dt"><span class="math display">\[
F_{slow} = \frac{dC_{slow}}{dt} = C_{bott} K_L e^{-K_L t}
\tag{4}\]</span></span></p>
<p>The integral of the function <span class="math inline">\(K_L exp(-K_L t)\)</span> from zero to infinity is equal to 1. This functional form is chosen in order to conserve mass: the total amount of lime on the bottom of the lake is enough to increase the lake concentration by <span class="math inline">\(C_{bott}\)</span> mg/l. Between any two time points, the function for <span class="math inline">\(F_{slow}\)</span> can be integrated to give a number between 0 and 1 representing the proportion of <span class="math inline">\(C_{bott}\)</span> that dissolves within the period. For periods soon after adding lime this proportion will be large, and it decays over time. However, because the total area under the curve is equal to one, the total amount of lime that dissolves from the bottom layer can never be greater than <span class="math inline">\(C_{bott}\)</span>.</p>
<p>The parameter <span class="math inline">\(K_L\)</span> (units <span class="math inline">\(month^{-1}\)</span>) is the “deaktiveringskoeffisient”, a constant that controls how fast lime on the lake bottom dissolves.</p>
<p>An initial Python implementation of this model is <a href="https://nbviewer.org/github/NIVANorge/lake_liming_app/blob/main/notebooks/box_model.ipynb">here</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>