<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Innsjøkalking applikasjon - Lake modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Innsjøkalking applikasjon</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.no.html" aria-current="page"> 
<span class="menu-text">Forside</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./user-guide.no.html"> 
<span class="menu-text">Brukerhåndboken</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lake-modelling.no.html"> 
<span class="menu-text">Innsjømodellering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./column-tests.no.html"> 
<span class="menu-text">Kolonnetester</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./user-guide.html"> 
<span class="menu-text">User guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lake-modelling.html"> 
<span class="menu-text">Lake modelling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./column-tests.html"> 
<span class="menu-text">Column tests</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lake-modelling.no.html">Innsjømodellering</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="https://github.com/NIVANorge/lake_liming_app">
            GitHub repository
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.no.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forside</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./user-guide.no.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Brukerhåndboken</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lake-modelling.no.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Innsjømodellering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./column-tests.no.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kolonnetester</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./user-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lake-modelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lake modelling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./column-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Column tests</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sek-bakgrunn" id="toc-sek-bakgrunn" class="nav-link active" data-scroll-target="#sek-bakgrunn"><span class="header-section-number">1</span> Bakgrunn</a>
  <ul class="collapse">
  <li><a href="#sec-lime-types" id="toc-sec-lime-types" class="nav-link" data-scroll-target="#sec-lime-types"><span class="header-section-number">1.1</span> Kalkingsmaterialer</a></li>
  <li><a href="#sec-solubility" id="toc-sec-solubility" class="nav-link" data-scroll-target="#sec-solubility"><span class="header-section-number">1.2</span> Kalkløselighet</a></li>
  </ul></li>
  <li><a href="#sec-modelling" id="toc-sec-modelling" class="nav-link" data-scroll-target="#sec-modelling"><span class="header-section-number">2</span> Modelleringsprosedyre</a>
  <ul class="collapse">
  <li><a href="#sec-ca-ph" id="toc-sec-ca-ph" class="nav-link" data-scroll-target="#sec-ca-ph"><span class="header-section-number">2.1</span> Forholdet mellom Ca-ekvivalenter og pH</a></li>
  <li><a href="#sec-mass-bal-model" id="toc-sec-mass-bal-model" class="nav-link" data-scroll-target="#sec-mass-bal-model"><span class="header-section-number">2.2</span> Massebalansemodell</a></li>
  <li><a href="#sec-inst-diss" id="toc-sec-inst-diss" class="nav-link" data-scroll-target="#sec-inst-diss"><span class="header-section-number">2.3</span> Estimating instantaneous dissolution</a></li>
  <li><a href="#sec-inst-diss" id="toc-sec-inst-diss" class="nav-link" data-scroll-target="#sec-inst-diss"><span class="header-section-number">2.4</span> Momentanoppløsning</a></li>
  <li><a href="#sec-standard-lake" id="toc-sec-standard-lake" class="nav-link" data-scroll-target="#sec-standard-lake"><span class="header-section-number">2.5</span> Simulering av en “standard innsjø”</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lake modelling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Beregningene utført av applikasjonen og beskrevet på denne siden er en delmengde av de som er implementert av den originale <a href="https://niva.brage.unit.no/niva-xmlui/handle/11250/208709">TPKALK-applikasjonen</a> utviklet av NIVA i løpet av 1990-tallet.</p>
<section id="sek-bakgrunn" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sek-bakgrunn"><span class="header-section-number">1</span> Bakgrunn</h2>
<section id="sec-lime-types" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="sec-lime-types"><span class="header-section-number">1.1</span> Kalkingsmaterialer</h3>
<p>Kalkprodukter som brukes til nedbørfeltforvaltning er vanligvis en blanding av <strong>kalsiumkarbonat</strong> (kalsitt, <span class="math inline">\(CaCO_3\)</span>) og <strong>magnesiumkarbonat</strong> (<span class="math inline">\(MgCO_3\)</span>). Bergarter som hovedsakelig består av <span class="math inline">\(CaCO_3\)</span> kalles vanligvis <strong>kalksteiner</strong> og <strong>kritt</strong>, mens karbonatbergarter med betydelige andeler magnesium kalles <strong>dolomitter</strong> (&gt; 10% Mg) eller magnesianske kalksteiner (2 til 10% Mg).</p>
<p>Kalkprodusenter vil typisk spesifisere andelen kalsium- og magnesiumkarbonat i produktene sine. For eksempel er ‘Microdol5’ rapportert å være 53,7% <span class="math inline">\(CaCO_3\)</span> og 44,4% <span class="math inline">\(MgCO_3\)</span> etter masse (med 1,9% andre urenheter).</p>
<p>Magnesiumkarbonat har en høyere andel karbonat etter masse og derfor en større syrenøytraliserende kapasitet (“Acid Neutralising Capacity”; ANC) enn kalsiumkarbonat: 1 g magnesiumkarbonat vil nøytralisere like mye syre som 1,19 g kalsiumkarbonat. Når man sammenligner kalk med forskjellige sammensetninger, er det derfor nødvendig å multiplisere magnesiumkarbonatandelen med en faktor på 1,19. Dette gir en <strong>nøytraliserende verdi (NV)</strong>, beregnet som summen av kalsiumkarbonat <em>ekvivalenter</em> (f.eks. <a href="#tbl-nv" class="quarto-xref">Table&nbsp;1</a>). NV bestemmes best ved titrering i henhold til EN-12945. Det kan også estimeres fra Ca- og Mg-elementanalyser, men i noen tilfeller kan disse elementene være fiksert til andre mineraler enn karbonater med liten eller ingen nøytraliserende kapasitet.</p>
<div id="tbl-nv" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-nv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Estimering av <strong>nøytraliserende verdi (NV)</strong> for to kalkprodukter. <span class="math inline">\(MgCO_3\)</span>-innhold konverteres til <span class="math inline">\(CaCO_3\)</span>-ekvivalenter ved å multiplisere med 1,19.
</figcaption>
<div aria-describedby="tbl-nv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 25%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Produkt</strong></th>
<th style="text-align: center;"><strong>CaCO3 (%)</strong></th>
<th style="text-align: center;"><strong>MgCO3 (%)</strong></th>
<th style="text-align: center;"><strong>MgCO3 (CaCO3-ekv; %)</strong></th>
<th style="text-align: center;"><strong>NV (sum of CaCO3-ekv; %)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Microdol5</strong></td>
<td style="text-align: center;">53.7</td>
<td style="text-align: center;">44.4</td>
<td style="text-align: center;">52.8</td>
<td style="text-align: center;">106.5</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>VK3</strong></td>
<td style="text-align: center;">99.0</td>
<td style="text-align: center;">1.0</td>
<td style="text-align: center;">1.2</td>
<td style="text-align: center;">100.2</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>NV er vanligvis spesifisert i prosent: rent kalsiumkarbonat har en NV på 100%; rent magnesiumkarbonat har en NV på 119%; og typiske dolomittprodukter har NV-er som er et sted i mellom. For samme masse vil produkter med høyere NV være mer effektive til å øke pH, <em>så lenge alle kalken løses opp</em>. I praksis viser forskjellige kalker forskjellige oppløsningshastigheter, som også må tas med i betraktning (<a href="#sec-solubility" class="quarto-xref">Section&nbsp;1.2</a>).</p>
</section>
<section id="sec-solubility" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="sec-solubility"><span class="header-section-number">1.2</span> Kalkløselighet</h3>
<p>Flere faktorer påvirker oppløsningshastigheten til kalkmateriale som tilsettes en vannmasse. Disse inkluderer:</p>
<ul>
<li><p><strong>Fysiske</strong> og <strong>kjemiske</strong> egenskaper til kalkmaterialet (krystallstruktur etc.).</p></li>
<li><p><strong>Partikkelstørrelse</strong> (dvs. finhet) av kalkmaterialet. Mindre partikler gir større reaksjonsflate og løses derfor raskere opp.</p></li>
<li><p><strong>Vann pH</strong>. Surere innsjøer reagerer kraftigere med kalken.</p></li>
<li><p><strong>Kalkpåføringsmetode</strong> (for eksempel fra båt versus fra helikopter).</p></li>
<li><p>Mengde tilsatt kalk, vanligvis kalt <strong>dosen</strong>. Hvis store mengder kalk tilsettes en innsjø på en gang, er den totale effekten på pH mindre enn det som kunne oppnås hvis mindre mengder ble tilsatt mer regelmessig. Dette skyldes at ved høye doser øker pH og kalsiumkonsentrasjon i umiddelbar nærhet av kalkpartiklene, som så synker til bunnen uten å løses effektivt opp. Det er også mer sannsynlig at kalkpartikler vil klumpe seg sammen og synke raskere. Denne effekten kalles <strong>overdosering</strong>.</p></li>
</ul>
<p>De fleste kommersielle kalkprodukter er fine nok til å oppløses effektivt. For en gitt påføringsmetode og innsjø-pH er målet derfor å identifisere <strong>hvilket kalkprodukt som skal brukes</strong> (dvs. hvilke fysiske og kjemiske egenskaper som skal velges) og <strong>i hvilken dose</strong> (for å minimere antall påføringer som er nødvendig uten overdosering).</p>
<p>Kalkoppløsningshastigheter og effekten av overdosering bestemmes eksperimentelt - se siden <a href="./column-tests.no.html">kolonnetester</a> for detaljer.</p>
</section>
</section>
<section id="sec-modelling" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-modelling"><span class="header-section-number">2</span> Modelleringsprosedyre</h2>
<p>Målet med modellen er å simulere endringer i innsjøens pH på grunn av kalking med ulike produkter. Det gir en del av bevisgrunnlaget for å avgjøre hvilke kalkprodukter som skal brukes under ulike omstendigheter.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Modellen forsøker å simulere en “typisk” innsjø og resultater må derfor betraktes som illustrative. Målte data fra ekte innsjøer viser at dose-respons-forhold er svært varierende og kan avhenge sterkt av lokale faktorer. Modellen bruker idealiserte empiriske sammenhenger basert på norske overvåkingsdata og laboratorietester. Den er ikke egnet for detaljert simulering av individuelle innsjøer.</p>
</div>
</div>
<section id="sec-ca-ph" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="sec-ca-ph"><span class="header-section-number">2.1</span> Forholdet mellom Ca-ekvivalenter og pH</h3>
<p>Når vi tilsetter kalkingsmateriale, øker konsentrasjonen av CaCO3 (og MgCO3, hvis relevant) i innsjøen, noe som fører til en økning i pH. <a href="#fig-titration-curves" class="quarto-xref">Figure&nbsp;1</a> viser forhold utledet empirisk av Atle Hindar som relaterer endringer i CaCO3-ekvivalenter til endringer i pH for innsjøer med forskjellige konsentrasjoner av totalt organisk karbon (TOC).</p>
<div id="fig-titration-curves" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-titration-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/titration_curves.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-titration-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Titreringskurver som relaterer endringer i CaCO3-ekvivalenter til endringer i pH for innsjøer med forskjellige konsentrasjoner av totalt organisk karbon (TOC).
</figcaption>
</figure>
</div>
<p>For en innsjø med en gitt initial pH- og TOC-konsentrasjon, bruker modellen sigmoid-kurver basert på empiriske data (<a href="#fig-titration-curves-interpolated" class="quarto-xref">Figure&nbsp;2</a>) for å finne en idealisert CaCO3-konsentrasjon som representerer innsjøens initiale bufferkapasitet. Modellen simulerer deretter endringer i CaCO3-ekvivalente konsentrasjoner over tid (i forhold til startkonsentrasjonen), og bruker kurvene til å estimere tilsvarende endringer i pH.</p>
<div id="fig-titration-curves-interpolated" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-titration-curves-interpolated-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/titration_curves_interpolated.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-titration-curves-interpolated-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Sigmoid-kurver tilpasset dataene i <strong>?@fig-titreringskurver</strong>. Disse brukes av modellen for å konvertere endringer i CaCO3-ekvivalenter til endringer i pH for innsjøer med forskjellige konsentrasjoner av totalt organisk karbon (TOC).
</figcaption>
</figure>
</div>
</section>
<section id="sec-mass-bal-model" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="sec-mass-bal-model"><span class="header-section-number">2.2</span> Massebalansemodell</h3>
<p>Titreringskurvene i <a href="#fig-titration-curves-interpolated" class="quarto-xref">Figure&nbsp;2</a> transformerer problemet med modellering av pH til modellering av <span class="math inline">\(\Delta Ca\)</span> (og <span class="math inline">\(\Delta Mg\)</span> også, hvis relevant). Når vi tilsetter kalk til en innsjø, løses noe av den opp umiddelbart, noe som gir en plutselig økning i pH, mens resten synker til bunnen og løses langsommere.</p>
<p>En massebalanse “boksmodell” (<a href="#fig-box-model" class="quarto-xref">Figure&nbsp;3</a>) brukes for å gi et estimat av både den umiddelbare endringen i innsjøforhold på grunn av kalking og den påfølgende utviklingen over tid. For enkelhets skyld vises kun ett sett med beregninger (f.eks. for kalsium), men et identisk sett med beregninger for magnesium utføres også parallelt, hvis det er relevant. Mg-fraksjonen omdannes deretter til CaCO3-ekvivalenter før det knyttes til endringer i pH (<a href="#sec-ca-ph" class="quarto-xref">Section&nbsp;2.1</a>). Med kalsium som eksempel, er symbolene i <a href="#fig-box-model" class="quarto-xref">Figure&nbsp;3</a> som følger:</p>
<ul>
<li><span class="math inline">\(D\)</span> er dosen av tilsatt kalk (justert for Ca-innhold, dvs. den faktiske dosen av Ca i mg/l).</li>
<li><span class="math inline">\(C_{inst}\)</span> er den “umiddelbare” økningen i innsjøens Ca-konsentrasjon (i mg/l) på grunn av <strong>momentanoppløsning</strong>.</li>
<li><span class="math inline">\(C_{bott} = (D - C_{inst})\)</span> er mengden Ca (i mg/l) som synker til bunnen av innsjøen og oppløses langsommere.</li>
<li><span class="math inline">\(F_{slow}\)</span> er hastigheten som konsentrasjonen øker med (i mg/l/måned) på grunn av oppløsning av bunnlaget.</li>
<li><span class="math inline">\(C_{in}\)</span> og <span class="math inline">\(C_{out}\)</span> er henholdsvis innløps- og utløpskonsentrasjonene av Ca (begge i mg/l).</li>
<li><span class="math inline">\(V\)</span> er innsjøvolumet i liter. Innsjøen antas å være i <strong>steady state</strong>, dvs. <span class="math inline">\(V\)</span> er konstant.</li>
<li><span class="math inline">\(Q\)</span> er vannføringen i l/måned. For å tilfredsstille “steady state”-forutsetningen, må innløpsvannføringen være likt utløpsvannføringen.</li>
<li><span class="math inline">\(M_{lake}\)</span> er massen av Ca oppløst i innsjøvannet (i mg).</li>
<li><span class="math inline">\(C_{lake}\)</span> er Ca-konsentrasjonen i innsjøen, lik <span class="math inline">\(\frac{M_{lake}}{V}\)</span>. Innsjøen antas å være <strong>godt blandet</strong>, slik at utløpskonsentrasjonen, <span class="math inline">\(C_{out}\)</span>, er lik <span class="math inline">\(C_{lake}\)</span>.</li>
</ul>
<div id="fig-box-model" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-box-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/box_model.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-box-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Skjematisk illustrasjon av en boksmodell for innsjøkalsiumkonsentrasjon for en enkelt innsjø under forutsetning av fast vannvolum. Symboler er definert i teksten.
</figcaption>
</figure>
</div>
<p>Balansering av de viktigste kildene og synker av Ca til innsjøen gir</p>
<p><span id="eq-dMlake_dt"><span class="math display">\[
\frac{dM_{lake}}{dt} = V \frac{dC_{lake}}{dt} = Q C_{in} - Q C_{lake} + V C_{inst} + V F_{slow}
\tag{1}\]</span></span></p>
<p>eller</p>
<p><span id="eq-dClake_dt"><span class="math display">\[
\frac{dC_{lake}}{dt} = \frac{Q C_{in} - Q C_{lake}}{V} + C_{inst} + F_{slow}
\tag{2}\]</span></span></p>
<p>Kalk som ikke løses opp umiddelbart synker til bunnen av innsjøen og løses opp saktere (<span class="math inline">\(C_{bott}\)</span>). Oppløsning av innsjøbunnkalk modelleres som en førsteordens reaksjon med starthastighetskoeffisient <span class="math inline">\(K_0\)</span>. Imidlertid antas denne hastighetskoeffisienten å avta eksponentielt over tid, basert på observasjonen at kalk som samler seg i innsjøsedimenter blir mindre “aktiv” over tid og derfor oppløses langsommere. Hastigheten som reaksjonskoeffisienten avtar med styres av “aktivitetskoeffisienten”, <span class="math inline">\(\lambda\)</span></p>
<p><span id="eq-Kt"><span class="math display">\[
K_t = K_0 e^{- \lambda t}
\tag{3}\]</span></span></p>
<p>der <span class="math inline">\(K_t\)</span> er førsteordens reaksjonskoeffisient ved tidspunktet <span class="math inline">\(t\)</span>.</p>
<p>Den effektive hastighetskoeffisienten, <span class="math inline">\(K_t\)</span>, modifiseres ytterligere av en “ratefaktor”, <span class="math inline">\(R\)</span>, som reduserer oppløsningshastigheten ettersom konsentrasjonene av oppløst CaCO3 i innsjøen blir høye. Spesielt tvinger <span class="math inline">\(R\)</span> <span class="math inline">\(K_t\)</span> mot null når oppløste konsentrasjoner nærmer seg metning. Dette gjøres først og fremst for å sikre at modellens resultater forblir plausibel selv om brukere setter ekstreme parameterverdier i brukergrensesnittet; for de fleste realistiske valg av modellparametere vil ikke innsjøkonsentrasjoner nærme seg metning og verdien av <span class="math inline">\(R\)</span> vil være nær 1.</p>
<p><span id="eq-R"><span class="math display">\[
R = \frac{1}{1 + e^{10 (C_{lake} - C_{sat})}}
\tag{4}\]</span></span></p>
<p>der <span class="math inline">\(C_{sat}\)</span> er metningskonsentrasjonen av Ca i innsjøvann (dvs. den maksimale verdien tillatt av modellen).</p>
<p><span id="eq-dCslow_dt"><span class="math display">\[
F_{slow} = - \frac{dC_{bott}}{dt} = C_{bott} K_t R
\tag{5}\]</span></span></p>
</section>
<section id="sec-inst-diss" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="sec-inst-diss"><span class="header-section-number">2.3</span> Estimating instantaneous dissolution</h3>
<p>For the model to produce reasonable simulations, it is important to have an accurate estimate for the proportion of lime material that dissolves quickly (i.e.&nbsp;the instantaneous dissolution fraction, <span class="math inline">\(C_{inst}\)</span>). Instantaneous dissolution can be measured in the laboratory using <a href="./column-tests.html">column tests</a>, which tell us how much lime will typically dissolve in a column given a known initial pH and lime dose. However, before the column test data can be used for lake modelling, it is necessary to adjust for:</p>
<ul>
<li><p><strong>Spreading method</strong>. For dry spreading (e.g.&nbsp;by helicopter) the amount of lime material that dissolves immediately is typically 0.5 to 0.7 times the proportion predicted by column tests. No adjustment is required for wet spreading (e.g.&nbsp;from a boat).</p></li>
<li><p><strong>Lake depth</strong>. Deeper lakes give the lime more time to dissolve as it sinks. In his PhD thesis, <a href="https://www.osti.gov/etdeweb/biblio/7808260">Sverdrup (1985)</a> noted that, for CaCO3, the instantaneous dissolution is directly proportional to both <span class="math inline">\(H^+\)</span> concentration and sinking depth</p></li>
</ul>
</section>
<section id="sec-inst-diss" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="sec-inst-diss"><span class="header-section-number">2.4</span> Momentanoppløsning</h3>
<p>For at modellen skal produsere fornuftige simuleringer, er det viktig å ha et nøyaktig estimat for andelen kalkmateriale som løses opp raskt (dvs. den momentanoppløsningsfraksjonen, <span class="math inline">\(C_{inst}\)</span>). Momentanoppløsning kan måles i laboratoriet ved hjelp av <a href="./kolonne-tests.no.qmd">kolonnetester</a>, som forteller oss hvor mye kalk som typisk vil løses opp i en kolonne gitt en kjent initial pH og kalkdose. Før kolonnetestdataene kan brukes til innsjømodellering, er det nødvendig å justere for:</p>
<ul>
<li><p><strong>Spredningsmetode</strong>. For tørrspredning (f.eks. med helikopter) er mengden kalkmateriale som oppløses umiddelbart, typisk 0,5 til 0,7 ganger andelen forutsagt av kolonnetester. Ingen justering er nødvendig for våtspredning (f.eks. fra båt).</p></li>
<li><p><strong>Innsjødybde</strong>. Dypere innsjøer gir kalken mer tid til å løse seg opp når den synker. I sin doktorgradsavhandling bemerket <a href="https://www.osti.gov/etdeweb/biblio/7808260">Sverdrup (1985)</a> at for CaCO3 er den momentanoppløsningen direkte proporsjonal med både <span class="math inline">\(H^+\)</span> konsentrasjon og synking dybde</p></li>
</ul>
<p><span id="eq-diss-h-depth"><span class="math display">\[
D_{inst} \propto [H^+] \times d
\tag{6}\]</span></span></p>
<p>Det er derfor mulig å generalisere momentanoppløsningsestimater fra kolonnetester med fast dybde til innsjøer med forskjellige dybder ved å vurdere kompenserende endringer i pH. For eksempel er forventet oppløsning for innsjø med dybde <span class="math inline">\(d\)</span> og hydrogenionkonsentrasjon <span class="math inline">\(H^+\)</span> den samme som for en innsjø med dybde <span class="math inline">\(2d\)</span> og hydrogenionkonsentrasjon <span class="math inline">\(0,5H^+\)</span>. Konvertering til pH, antas den momentanoppløsningen for en innsjø med dybde <span class="math inline">\(d_{lake}\)</span> og initial pH <span class="math inline">\(X\)</span> å være lik oppløsningen i en testkolonne med dybde <span class="math inline">\(d_{col}\)</span> med pH <span class="math inline">\((X - a)\)</span> der</p>
<p><span id="eq-cor-depth"><span class="math display">\[
a = log⁡(\frac{d_{lake}}{d_{col}})
\tag{7}\]</span></span></p>
<p>Merk at <a href="#eq-cor-depth" class="quarto-xref">Equation&nbsp;7</a> gjelder for CaCO3-fraksjonen; for MgCO3 foreslo Sverdrup modifikasjonen <span class="math inline">\((X - 0,5a)\)</span> som en mer passende dybdekorreksjon.</p>
</section>
<section id="sec-standard-lake" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="sec-standard-lake"><span class="header-section-number">2.5</span> Simulering av en “standard innsjø”</h3>
<p>Modellen definert ovenfor er i stand til å simulere hvordan pH og Ca-konsentrasjon (og Mg, hvis relevant) endres over tid for en enkelt innsjø. Modellen krever følgende inndata:</p>
<ul>
<li><p>Innsjø <strong>volum</strong> (ofte oppgitt som overflateareal og gjennomsnittlig dybde) og <strong>vannføring</strong>, som sammen definerer <strong>oppholdstiden</strong>. Merk at denne modellen forutsetter at volumet er fast, men vannføringen kan variere over tid, om ønskelig.</p></li>
<li><p><strong>Innsjøens pH</strong>, <strong>innløps-pH</strong> og <strong>TOC-konsentrasjon</strong>.</p></li>
<li><p><strong>dosen</strong> av tilsatt kalkmateriale og <strong>andelen Ca og Mg etter masse</strong> i kalken. <strong>Overdoseringsfaktorer</strong> er også relevante for høyere doser.</p></li>
<li><p><strong>Innsjømiddeldybde</strong> og <strong>spredningsmetode</strong> (dvs. “våt” eller “tørr”), som begge brukes til å justere de momentanoppløsningsverdiene fra kolonnetester (<a href="#eq-cor-depth" class="quarto-xref">Equation&nbsp;7</a>).</p></li>
<li><p>Parameterne <span class="math inline">\(K_0\)</span> og <span class="math inline">\(\lambda\)</span>, som bestemmer hvor raskt kalk på innsjøbunnen løses opp, og hvor lenge den forblir “aktiv”.</p></li>
</ul>
<p>For å unngå å måtte spesifisere alle disse parameterne ved sammenligning av ulike kalkprodukter, er det vanlig å vurdere en <strong>standard innsjø</strong> med et areal på 20 ha, gjennomsnittlig dybde på 5 m og gjennomsnittlig oppholdstid på 0,7 år. Disse parameterne definerer i sin tur gjennomsnittlig årlig utslipp. Om ønskelig kan dette endres ved å velge en månedlig <strong>vannføringsprofil</strong> (<code>fjell</code> eller <code>kyst</code>; se <strong>?@fig-flow-profiler</strong>), som justerer vannføring opp eller ned i hver måned, men i en slik måte at det samlede årlige gjennomsnittet opprettholder en oppholdstid på 0,7 år.</p>
<div id="fig-flow-profiles" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-flow-profiles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/flow_typologies.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-flow-profiles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Månedlige vannføringsprofiler som kan brukes til å endre konstantverdiene.
</figcaption>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/NIVANorge\.github\.io\/lake_liming_app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>